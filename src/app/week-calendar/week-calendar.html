<div
  #calendarContainer
  class="calendar-container"
  (dragstart)="$event.preventDefault()"
  [style.--time-slots-column-width.px]="timeSlotsColumnWidth"
>
  <div class="header-row">
    <div class="time-slot-header" [style.height.px]="headerHeight"></div>
    @for (day of days; track $index) {
    <div class="day-header" [style.height.px]="headerHeight">{{ day }}</div>
    }
  </div>
  @for (hour of hours(); track $index) {
  <div class="calendar-row">
    <div class="time-slot">{{ hour }}</div>
    @for (day of days; track $index) {
    <div
      class="calendar-cell"
      [class.selected]="selectedCellMap().has(day + '-' + hour)"
      [style.height.px]="cellHeight"
      (mousedown)="onDragStart(day, hour)"
      (mouseenter)="onDragOver(day, hour)"
      [attr.data-day]="day"
      [attr.data-hour]="hour"
    ></div>
    }
  </div>
  }
  <div class="events-container">
    @for (event of events; track $index) {
    <div class="event" [style]="event.style">{{ event.title }}</div>
    } @if (pendingEvent(); as pending) {
    <div class="event pending" [style]="pending.style">
      <input
        #eventInput
        type="text"
        [style.background]="newEventColor()"
        [(ngModel)]="newEventTitle"
        (blur)="onEventInputBlur()"
        (keydown.enter)="confirmEventCreation()"
        (keydown.escape)="pendingEvent.set(null)"
        placeholder="כותרת..."
      />
      <div class="pending-controls" (mousedown)="onPendingControlMouseDown($event)">
        <div class="color-picker-wrapper">
          <button
            type="button"
            class="color-picker-button"
            [style.background]="newEventColor()"
            (click)="toggleColorPalette()"
            title="Pick event color"
            aria-label="Pick event color"
          ></button>
        </div>
      </div>
    </div>
    }
  </div>
  @if (colorPaletteOpen() && pendingEvent()) {
  <div
    class="color-palette-dropdown"
    [style.top]="colorPickerButtonPosition()?.top"
    [style.left]="colorPickerButtonPosition()?.left"
    (click)="toggleColorPalette()"
  >
    @for (color of colorPalette; track color) {
    <button
      type="button"
      class="palette-color"
      [style.background]="color"
      [class.active]="newEventColor() === color"
      (click)="setEventColor(color); $event.stopPropagation()"
      [attr.title]="'Color: ' + color"
      [attr.aria-label]="'Color: ' + color"
    ></button>
    }
  </div>
  }
</div>
